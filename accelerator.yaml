accelerator:
  displayName: Spring Sensors
  description: A Spring application for tracking sensor data
  iconUrl: https://github.com/sample-accelerators/icons/raw/master/sensor-dashboard.png
  tags:
    - java
    - spring
    - tanzu

  options:
    - name: title
      label: Title
      display: true
      description: Title text for the application
      inputType: text
      dataType: string
      defaultValue: "Tanzu Sensor Database"

    - name: gitUrl
      label: Git Repository URL
      display: true
      description: Git Repository URL of the application's source code
      inputType: text
      dataType: string
      defaultValue: "https://github.com/sample-accelerators/spring-sensors-rabbit.git"

    - name: gitBranch
      label: Git Repository Branch
      display: true
      description: Git Repository Branch of the application's source code
      inputType: text
      dataType: string
      defaultValue: "main"

    - name: publisherRepository
      inputType: text
      label: Name of repository to use for the publisher container image
      defaultValue: harbor.h2o-37-1123.h2o.vmware.com/tap/sc/spring-sensors-explore
      description: The repository name to use for the publisher image built as part of this sample. Specify server/repository that match what was specified for registry.server and registry.repository for ootb-supply-chain-basic.
      required: true
    - name: repositoryPrefix
      inputType: text
      label: Prefix for the container image repository
      defaultValue: harbor.h2o-37-1123.h2o.vmware.com/tap/sc
      required: true
    - name: iterateClusterContext
      inputType: text
      label: Allowed Kubernetes context for iterative development
      defaultValue: tap-iterate
      required: true
    - name: developerNamespace
      inputType: text
      label: Developer namespace on Kubernetes cluster
      defaultValue: dev
      required: true

engine:
  merge:
    - include: [ "**" ]
      exclude: [ "tap/workload.yaml", "demo/**", "src/main/resources/application.yaml", "catalog/*.yaml" ]
    - include: [ "Tiltfile" ]
      chain:
      - type: ReplaceText
        substitutions:
        - text: spring-sensors
          with: "#artifactId"
      - type: ReplaceText
        substitutions:
        - text: your-registry.io/project
          with: "#repositoryPrefix"
      - type: ReplaceText
        substitutions:
        - text: kind-cluster
          with: "#iterateClusterContext"
      - type: ReplaceText
        substitutions:
        - text: "'default'"
          with: "'''' + #developerNamespace + ''''"
    - include: [ "tap/workload.yaml" ]
      chain:
        - type: ReplaceText
          substitutions:
            - text: https://github.com/tanzu-end-to-end/spring-sensors.git
              with: "#gitUrl"
            - text: main
              with: "#gitBranch"
        - type: RewritePath
          rewriteTo: "'config/' + #filename"
    - include: [ "src/main/resources/application.yaml" ]
      chain:
        - type: ReplaceText
          substitutions:
             - text: Sensor Database
               with: "#title"
    - include: [ "demo/publisher-deployment.yaml", "demo/publisher-image.yaml" ]
      chain:
        - type: ReplaceText
          substitutions:
            - text: dev.local/spring-sensors-publisher
              with: "#publisherRepository"
    - include: [ "catalog/*.yaml" ]
      chain:
      - type: ReplaceText
        substitutions:
        - text: spring-sensors
          with: "#artifactId"
